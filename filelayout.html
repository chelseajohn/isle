<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>isle: File Layout</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script src="striped_bg.js"></script>
<link href="that_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">isle
   &#160;<span id="projectnumber">0.2</span>
   </div>
   <div id="projectbrief">Lattice Monte Carlo for Carbon Nanostructures</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('filelayout.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">File Layout </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Almost all components of Isle use HDF5 files with a common layout to store data. Many functions are flexible though and can read from files that have slightly different layouts. In the interest of compatibility however, the default layout should be used whenever possible.</p>
<h2>HDF5 Files</h2>
<p>With the exception of lattices (see below), all data is stored in HDF5 files. Isle uses two kinds of such files, <em>configuration</em> and <em>measurement</em> files. Those kinds are compatible and it is possible to store all data in a single file.</p>
<h3>Configuration Files</h3>
<p>Configuration files always contain three groups at the root level:</p><ul>
<li><b><code>configuration</code></b>: Stores field configurations obtained from HMC. The group contains additional groups labeled by the trajectory index. Each of those groups contains three fields<ul>
<li><code>phi</code>: The field configuration. (Complex lattice vector)</li>
<li><code>action</code>: Value of the action for that configuration. (complex number)</li>
<li><code>trajPoint</code>: Point along the trajectory that was accepted. (integer)</li>
</ul>
</li>
<li><b><code>checkpoint</code></b>: Stores checkpoints along the Markov chain to resume HMC runs. The group contains additional groups labeled by the trajectory index. Note that there can be fewer checkpoints than configurations. Each of those groups contains three fields<ul>
<li><code>cfg</code>: The field configuration. (Link to sub group <code>/configuration</code>)</li>
<li><code>rng_state</code>: State of the RNG at the end of the trajectory. The content depends on the specific RNG but there is always a dataset called <code>name</code> which identifies the RNG. (HDF5 group)</li>
<li><code>evolver</code>: A group containing the state of the evolver at the end of the trajectory. See below for more information. (HDF5 group)</li>
</ul>
</li>
<li><b><code>meta</code></b>: Stores information on the physical system and algorithmic parameters. Contains the following objects:<ul>
<li><code>action</code>: Source code of a function that instantiates the action which was used to generate the configurations in the file. (String)</li>
<li><code>lattice</code>: YAML representation of the lattice, see below. (String)</li>
<li><code>params</code>: YAML representation of the parameters dataclass object. Stores user defined parameters, physical and otherwise. (String)</li>
<li><code>evolvers</code>: General information on evolvers, see below. (Group)</li>
<li><code>version</code>: Group containing various versions of the software that was used to make the file, most notably the version of Isle. All versions are stored as strings.</li>
</ul>
</li>
</ul>
<h4>Evolvers</h4>
<p>Evolvers are stored in two different places in HDF5 files. The <code>/meta/evolvers</code> group contains an enumerated list of the types of evolvers and <code>/checkpoint/&lt;itr&gt;/evolver</code> contains the state of the evolver after the corresponding HMC trajectory.</p>
<p>The types of evolvers are stored so they can be reconstructed at a later point in time to, for instance, continue an HMC run. Types are saved on demand only; as long as no checkpoints are written, no types are saved.<br />
 There are two ways, the types can be stored:</p><ul>
<li>If the evolver is built into Isle or passed to the EvolverManager instance via the <code>definitions</code> parameter (e.g. through the parameter <code>definitions</code> of <code>isle.drivers.meas.newRun</code>), only its name is stored in a dataset called <code>__name__</code>.</li>
<li>If the evolver is custom defined and not included in <code>definitions</code>, the full source code of the evolver's definition is stored and <code>__name__</code> is set to <code>"__as_source__"</code>. The dataset <code>__source__</code> contains the full source code of the evolver.</li>
</ul>
<p>The group of the evolver state contains an attribute <code>__index__</code> which holds an integer indicating which entry in the types group contains the evolver's type. Any other content is determined by the evolver itself. Evolvers are allowed to refer to the type definitions.</p>
<dl class="section see"><dt>See also</dt><dd>Additional information on evolvers, in particular handling of types, can be found in <a class="el" href="evolversdoc.html">Evolvers</a>.</dd></dl>
<h3>Measurement Files</h3>
<p>Measurement files contain the same metadata at the root level as configuration files. In addition, the results of measurements are written to the root level but each measurement writes into its own separate group. All group names depend on the user and can be chosen when calling the measurement driver. The group contents are determined by the measurements.</p>
<p>The only common element is an attribute to the group called <code>configurations</code>. This attribute contains a string in slice notation (<code>start:stop:step</code>) indicating which configurations the measurement was taken on. The indices in those slices are interpreted relative to the trajectory indices (group names) of configurations in the <code>/configuration</code> group.</p>
<h3>Example</h3>
<p>Here is an example of a combined configuration and measurement file: </p><div class="fragment"><div class="line">╿</div><div class="line">├─ configuration</div><div class="line">│  ├─ 2</div><div class="line">│  │  ├─ phi (complex lattice vector)</div><div class="line">│  │  ├─ action (complex number)</div><div class="line">│  │  └─ trajPoint (integer)</div><div class="line">│  │</div><div class="line">│  ├─ 4</div><div class="line">│  │  ├─ phi (complex lattice vector)</div><div class="line">│  │  ├─ action (complex number)</div><div class="line">│  │  └─ trajPoint (integer)</div><div class="line">│  ┆</div><div class="line">│</div><div class="line">├─ checkpoint</div><div class="line">│  ├─ 2</div><div class="line">│  │  ├─ cfg (link to /configuration/0)</div><div class="line">│  │  ├─ rng_state (group, RNG dependent)</div><div class="line">│  │  └─ evolver (group, evolver dependent)</div><div class="line">│  ┆</div><div class="line">│</div><div class="line">├─ meta</div><div class="line">│  ├─ action (source of function)</div><div class="line">│  ├─ lattice (YAML)</div><div class="line">│  ├─ params (YAML)</div><div class="line">│  ├─ evolvers (group)</div><div class="line">│  └─ versions (group)</div><div class="line">│</div><div class="line">│  # measurements:</div><div class="line">│</div><div class="line">├─ action</div><div class="line">│  ├─ [configurations] (string attribute)</div><div class="line">│  └─ action (dataset)</div><div class="line">│</div><div class="line">├─ correlation_functions</div><div class="line">│  ├─ single_particle</div><div class="line">│  │  ├─ [configurations] (string attribute)</div><div class="line">│  │  ├─ correlators (dataset)</div><div class="line">│  │  └─ irreps (dataset)</div><div class="line">│  └─ single_hole</div><div class="line">│     ├─ [configurations] (string attribute)</div><div class="line">│     ├─ correlators (dataset)</div><div class="line">│     └─ irreps (dataset)</div><div class="line">┆</div></div><!-- fragment --><h2>Lattice Files</h2>
<p>Lattices are stored as <a href="https://yaml.org/">YAML</a>. Those YAML strings are by default stored in stand alone files (/resources/lattices) or as part of the metadata in HDF5 files (see above).</p>
<p>Lattices are encoded via custom YAML nodes denoted by <code>!lattice</code>. These nodes contain a mapping with the following keys:</p><ul>
<li><b><code>name</code></b>: A string identifying the lattice. Should be unique to avoid conflicts.</li>
<li><b><code>comment</code></b>: An arbitrary string to give detailed information on the lattice.</li>
<li><b><code>adjacency</code></b>: A list of lists describing the adjacency matrix. Each element of the outer list is a list of two integers indicating that those two sites are connected.</li>
<li><b><code>hopping</code></b>: Can be either<ul>
<li>A float: The hopping strength for all connections in the lattice.</li>
<li>A list of floats: Hopping strength for each connection. Must be the same length as <code>adjacency</code> and is specified in the same order.</li>
</ul>
</li>
<li><b><code>positions</code></b>: List of lists containing the 3D positions of all lattice sites. Each element of the outer list is a list of three floats, the 3D coordinates of that site.<br />
 This field determines how many lattice sites there are and which order they are indexed in. Both <code>adjacency</code> and <code>hopping</code> have to be consistent with that.</li>
<li><b><code>nt</code></b>: The number of time slices. This field is <em>optional</em> and defaults to 0. Stand alone files should not set <code>nt</code> but only describe the spatial properties of the lattice. This allows those files to be reused easily but users have to make sure to set <code>nt</code> manually after reading a lattice from YAML.</li>
</ul>
<p>Here is an example of a lattice with four sites in a hexagonal alignment. This is taken from /resources/lattices/four_sites.yml.<br />
 In this lattice, site 0 is connected to site 1 with hopping strength 1 and to site 3 with strength 2, etc. The position of site 0 is <code>(0, 0, 0)</code>, of site 1 is <code>(1, 0, 0)</code>, etc.</p>
<div class="fragment"><div class="line">!lattice</div><div class="line">name: &#39;four sites&#39;</div><div class="line">comment: &#39;Four sites (hexagonal)&#39;</div><div class="line">adjacency:</div><div class="line">  - [0, 1]</div><div class="line">  - [0, 3]</div><div class="line">  - [1, 2]</div><div class="line">  - [2, 3]</div><div class="line">hopping: [1, 2, 2, 1]</div><div class="line">positions:</div><div class="line">  - [0, 0, 0]</div><div class="line">  - [1, 0, 0]</div><div class="line">  - [1.5, 0.866025403784439, 0]</div><div class="line">  - [2.5, 0.866025403784439, 0]</div><div class="line">nt: 32</div></div><!-- fragment --><dl class="section see"><dt>See also</dt><dd><a class="el" href="namespaceisle_1_1yamlio.html#ab55bb489572fddd4ae218690d7cab74b" title="Load a Lattice from a YAML file. ">isle.yamlio.loadLattice</a> for a convenient way to read lattices from YAML files.<br />
 Thanks to the custom node, lattices can be loaded via <code>yaml.safe_load(lattice_string)</code> and saved via <code>yaml.dump(lattice)</code>. </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
