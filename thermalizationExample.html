<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>isle: Thermalization</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script src="striped_bg.js"></script>
<link href="that_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">isle
   &#160;<span id="projectnumber">0.2</span>
   </div>
   <div id="projectbrief">Lattice Monte Carlo for Carbon Nanostructures</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('thermalizationExample.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Thermalization </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This example shows how to set up an HMC run and start producing configurations. The chosen evolver and parameters are meant for thermalization. The transition to production can for instance be done with <a class="el" href="changeExample.html">Change Evolver</a>.</p>
<p>This example also serves to show how to define a custom command line argument parser which ties in with Isle's initialization routine.</p>
<p>The following code can be found in <code><a class="el" href="hmcThermalization_8py_source.html">docs/examples/hmcThermalization.py</a></code>. </p><div class="fragment"><div class="line"><span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><span class="stringliteral">Example that demonstrates how to set up a custom argument parser</span></div><div class="line"><span class="stringliteral">and start a run by thermalizing a configuration.</span></div><div class="line"><span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"></div><div class="line"><span class="comment"># All output should go through a logger for better control and consistency.</span></div><div class="line"><span class="keyword">from</span> logging <span class="keyword">import</span> getLogger</div><div class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</div><div class="line"></div><div class="line"><span class="comment"># Import base functionality of Isle.</span></div><div class="line"><span class="keyword">import</span> isle</div><div class="line"><span class="comment"># Import drivers (not included in above).</span></div><div class="line"><span class="keyword">import</span> <a class="code" href="namespaceisle_1_1drivers.html">isle.drivers</a></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># Load lattice from this file.</span></div><div class="line">LATTICE = Path(__file__).resolve().parent/<span class="stringliteral">&quot;../../resources/lattices/four_sites.yml&quot;</span></div><div class="line"></div><div class="line"></div><div class="line">PARAMS = <a class="code" href="util_8py.html#abf17f7d65da41753a9af910d8a632437">isle.util.parameters</a>(</div><div class="line">    beta=2.3,         <span class="comment"># inverse temperature</span></div><div class="line">    U=4.1,            <span class="comment"># on-site coupling</span></div><div class="line">    mu=0,           <span class="comment"># chemical potential</span></div><div class="line">    sigmaKappa=-1,  <span class="comment"># prefactor of kappa for holes / spin down</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="comment"># Set the number of time slices.</span></div><div class="line"><span class="comment"># This is stored in isle.Lattice and does not go into the above object.</span></div><div class="line">NT = 8</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">def </span>makeAction(lat, params):</div><div class="line">    <span class="comment"># Import everything this function needs so it is self-contained.</span></div><div class="line">    <span class="keyword">import</span> isle</div><div class="line">    <span class="keyword">import</span> <a class="code" href="namespaceisle_1_1action.html">isle.action</a></div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="classisle_1_1action_1_1HubbardGaugeAction.html">isle.action.HubbardGaugeAction</a>(params.tilde(<span class="stringliteral">&quot;U&quot;, lat)) \</span></div><div class="line"><span class="stringliteral">        + isle.action.makeHubbardFermiAction(lat,                                             params.beta,</span></div><div class="line"><span class="stringliteral">                                             params.tilde(&quot;mu&quot;</span>, lat),</div><div class="line">                                             params.sigmaKappa)</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">def </span>_init():</div><div class="line">    <span class="stringliteral">&quot;&quot;&quot;Initialize Isle.&quot;&quot;&quot;</span></div><div class="line"></div><div class="line">    <span class="comment"># Define a custom command line argument parser.</span></div><div class="line">    <span class="comment"># Isle uses Python&#39;s argparse package and the following returns a new parser</span></div><div class="line">    <span class="comment"># which is set up to accept some default arguments like --version, --verbose, or --log.</span></div><div class="line">    parser = <a class="code" href="cli_8py.html#aae116100a013d5819dfe06f8b6f3f86c">isle.cli.makeDefaultParser</a>(defaultLog=<span class="stringliteral">&quot;therm_example.log&quot;</span>,</div><div class="line">                                        description=<span class="stringliteral">&quot;Example script to thermalize a configuration&quot;</span>)</div><div class="line">    <span class="comment"># Add custom arguments to control this script in particular.</span></div><div class="line">    parser.add_argument(<span class="stringliteral">&quot;outfile&quot;</span>, help=<span class="stringliteral">&quot;Output file&quot;</span>, type=Path)</div><div class="line">    parser.add_argument(<span class="stringliteral">&quot;-n&quot;</span>, <span class="stringliteral">&quot;--ntrajectories&quot;</span>, type=int, metavar=<span class="stringliteral">&quot;N&quot;</span>, required=<span class="keyword">True</span>,</div><div class="line">                        help=<span class="stringliteral">&quot;Generate N trajectories&quot;</span>)</div><div class="line">    parser.add_argument(<span class="stringliteral">&quot;-s&quot;</span>, <span class="stringliteral">&quot;--save-freq&quot;</span>, type=int, metavar=<span class="stringliteral">&quot;SF&quot;</span>, default=1,</div><div class="line">                        help=<span class="stringliteral">&quot;Save every SF trajectories (default=1)&quot;</span>)</div><div class="line">    parser.add_argument(<span class="stringliteral">&quot;-c&quot;</span>, <span class="stringliteral">&quot;--checkpoint-freq&quot;</span>, type=int, metavar=<span class="stringliteral">&quot;CF&quot;</span>, default=<span class="keywordtype">None</span>,</div><div class="line">                        help=<span class="stringliteral">&quot;Write a checkpoint every CF trajectories (default=0)&quot;</span>)</div><div class="line">    parser.add_argument(<span class="stringliteral">&quot;--overwrite&quot;</span>, action=<span class="stringliteral">&quot;store_true&quot;</span>,</div><div class="line">                        help=<span class="stringliteral">&quot;Overwrite existing output file.&quot;</span>)</div><div class="line"></div><div class="line">    <span class="comment"># Initialize Isle and process arguments with the new parser.</span></div><div class="line">    args = <a class="code" href="namespaceisle.html#a4b36be9317900433e26eaa00b7237cb7">isle.initialize</a>(parser)</div><div class="line"></div><div class="line">    <span class="comment"># If no checkpoint frequency is given, save a checkpoint for the last</span></div><div class="line">    <span class="comment"># configuration to make sure the run can be continued.</span></div><div class="line">    <span class="keywordflow">if</span> args.checkpoint_freq <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line">        <span class="comment"># The number of saved configurations.</span></div><div class="line">        nsaved = args.ntrajectories // args.save_freq</div><div class="line">        <span class="comment"># Place a checkpoint only for the last saved configuration.</span></div><div class="line">        args.checkpoint_freq = nsaved * args.save_freq</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> args</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">def </span>main():</div><div class="line">    args = _init()</div><div class="line"></div><div class="line">    <span class="comment"># Load the spatial lattice.</span></div><div class="line">    lat = isle.fileio.yaml.loadLattice(LATTICE)</div><div class="line">    <span class="comment"># Store nt.</span></div><div class="line">    lat.nt(NT)</div><div class="line"></div><div class="line">    <span class="comment"># Set up a random number generator.</span></div><div class="line">    rng = <a class="code" href="classisle_1_1random_1_1NumpyRNG.html">isle.random.NumpyRNG</a>(1337)</div><div class="line"></div><div class="line">    <span class="comment"># Set up a fresh HMC driver.</span></div><div class="line">    hmcState = <a class="code" href="hmc_8py.html#abdf4d13a0e7a9eb045b75f29e497f15a">isle.drivers.hmc.newRun</a>(lat, PARAMS, rng, makeAction,</div><div class="line">                                       args.outfile, args.overwrite)</div><div class="line"></div><div class="line">    <span class="comment"># Generate a random initial condition.</span></div><div class="line">    <span class="comment"># Note that configurations must be vectors of complex numbers.</span></div><div class="line">    phi = <a class="code" href="classisle_1_1cpp__wrappers_1_1Vector.html">isle.Vector</a>(rng.normal(0,</div><div class="line">                                 PARAMS.tilde(<span class="stringliteral">&quot;U&quot;, lat)**(1/2),</span></div><div class="line"><span class="stringliteral">                                 lat.lattSize())</span></div><div class="line"><span class="stringliteral">                      +0j)</span></div><div class="line"><span class="stringliteral"></span></div><div class="line"><span class="stringliteral">    </span><span class="comment"># Run thermalization.</span></div><div class="line">    <a class="code" href="namespaceisle.html#ab26d96123c95ced1a69a81682cd706c9">getLogger</a>(__name__).info(<span class="stringliteral">&quot;Thermalizing&quot;</span>)</div><div class="line">    <span class="comment"># Pick an evolver which linearly decreases the number of MD steps from 20 to 5.</span></div><div class="line">    evolver = <a class="code" href="classisle_1_1evolver_1_1LinearStepLeapfrog.html">isle.evolver.LinearStepLeapfrog</a>(hmcState.action, (1, 1), (20, 5),</div><div class="line">                                              args.ntrajectories-1, rng)</div><div class="line">    <span class="comment"># Thermalize configuration using the command line arguments.</span></div><div class="line">    hmcState(phi, evolver, args.ntrajectories,</div><div class="line">             saveFreq=args.save_freq, checkpointFreq=args.checkpoint_freq)</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordflow">if</span> __name__ == <span class="stringliteral">&quot;__main__&quot;</span>:</div><div class="line">    main()</div><div class="line"></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="examplesdoc.html">Examples</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
